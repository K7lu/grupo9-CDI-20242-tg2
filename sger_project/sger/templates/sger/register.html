{% extends "base.html" %}

{% block content %}
<div class="max-w-2xl mx-auto mt-10 bg-white p-8 rounded-lg shadow-lg">
    <!-- Logo -->
    <div class="flex justify-center mb-6">
        <i class="bi bi-person-plus-fill text-7xl text-[#003366]"></i>
    </div>
    <h2 class="text-3xl font-bold text-center mb-6 text-[#003366]">Criar uma Conta</h2>

    <!-- Formulário -->
    <form id="registerForm" action="{% url 'register' %}" method="POST" onsubmit="return validateForm()">
        {% csrf_token %}
        
        <div class="grid grid-cols-2 gap-4">
            <!-- Usuário -->
            <div class="mb-4 col-span-2">
                <label for="username" class="block text-sm font-medium text-gray-600">Usuário</label>
                <input type="text" id="username" name="username" placeholder="Digite seu usuário"
                    class="w-full px-4 py-2 border rounded-lg focus:ring-[#003366]" required>
            </div>

            <!-- Nome Completo -->
            <div class="mb-4 col-span-2">
                <label for="full_name" class="block text-sm font-medium text-gray-600">Nome Completo</label>
                <input type="text" id="full_name" name="full_name" placeholder="Digite seu nome completo"
                    class="w-full px-4 py-2 border rounded-lg focus:ring-[#003366]" required>
            </div>

            <!-- Email -->
            <div class="mb-4 col-span-2">
                <label for="email" class="block text-sm font-medium text-gray-600">Email</label>
                <input type="email" id="email" name="email" placeholder="Digite seu email"
                    class="w-full px-4 py-2 border rounded-lg focus:ring-[#003366]" required>
            </div>

            <!-- CPF -->
            <div class="mb-4">
                <label for="cpf" class="block text-sm font-medium text-gray-600">CPF</label>
                <input type="text" id="cpf" name="cpf" placeholder="Digite seu CPF"
                    class="w-full px-4 py-2 border rounded-lg focus:ring-[#003366]" maxlength="11">
            </div>

            <!-- CNPJ -->
            <div class="mb-4">
                <label for="cnpj" class="block text-sm font-medium text-gray-600">CNPJ</label>
                <input type="text" id="cnpj" name="cnpj" placeholder="Digite seu CNPJ"
                    class="w-full px-4 py-2 border rounded-lg focus:ring-[#003366]" maxlength="14">
            </div>

            <!-- Endereço -->
            <div class="mb-4 col-span-2">
                <label for="endereco" class="block text-sm font-medium text-gray-600">Endereço</label>
                <input type="text" id="endereco" name="endereco" placeholder="Digite seu endereço completo"
                    class="w-full px-4 py-2 border rounded-lg focus:ring-[#003366]">
            </div>

            <!-- Telefone -->
            <div class="mb-4 col-span-2">
                <label for="telefone" class="block text-sm font-medium text-gray-600">Telefone</label>
                <input type="text" id="telefone" name="telefone" placeholder="(XX) XXXXX-XXXX"
                    class="w-full px-4 py-2 border rounded-lg focus:ring-[#003366]">
            </div>

            <!-- Senha -->
            <div class="mb-4">
                <label for="password" class="block text-sm font-medium text-gray-600">Senha</label>
                <input type="password" id="password" name="password" placeholder="Digite uma senha forte"
                    minlength="6" class="w-full px-4 py-2 border rounded-lg focus:ring-[#003366]" required>
            </div>

            <!-- Confirmação de Senha -->
            <div class="mb-4">
                <label for="confirm_password" class="block text-sm font-medium text-gray-600">Confirme a Senha</label>
                <input type="password" id="confirm_password" name="confirm_password" placeholder="Confirme sua senha"
                    class="w-full px-4 py-2 border rounded-lg focus:ring-[#003366]" required>
            </div>
        </div>

        <!-- Botão Registrar -->
        <div class="mt-6">
            <button type="submit" id="registerBtn"
                    class="w-full bg-green-600 text-white py-2 px-4 rounded-lg font-medium hover:bg-green-700 transition duration-300">
                <i class="bi bi-person-plus-fill mr-2"></i> Registrar
            </button>
        </div>
    </form>

    <!-- Link para Login -->
    <div class="text-center mt-6">
        <p class="text-sm text-gray-600">Já tem uma conta? 
            <a href="{% url 'login' %}" class="text-blue-600 font-medium hover:underline transition">Faça login</a>
        </p>
    </div>
</div>

<!-- JavaScript -->
<script>
    function validateForm() {
        const email = document.getElementById("email").value.trim();
        const cpf = document.getElementById("cpf").value.trim();
        const cnpj = document.getElementById("cnpj").value.trim();

        // Valida email
        if (!validateEmail(email)) {
            alert("Por favor, insira um email válido.");
            return false;
        }

        // Valida CPF ou CNPJ
        if (cpf === "" && cnpj === "") {
            alert("Por favor, preencha pelo menos o CPF ou o CNPJ.");
            return false;
        }

        if (cpf.length > 0 && cpf.length !== 11) {
            alert("O CPF deve conter exatamente 11 dígitos.");
            return false;
        }

        if (cnpj.length > 0 && cnpj.length !== 14) {
            alert("O CNPJ deve conter exatamente 14 dígitos.");
            return false;
        }

        // Prevenção de submissão duplicada
        document.getElementById("registerBtn").disabled = true;
        return true;
    }

    function validateEmail(email) {
        const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return re.test(email);
    }
</script>
{% endblock %}
